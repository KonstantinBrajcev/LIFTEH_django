<div style="display:flex; margin: 5px; justify-content: space-around; flex-wrap: wrap; gap: 5px;">

<style>
.dropdown-menu.color-dropdown-fixed {
    position: fixed !important;
    transform: none !important;
    inset: auto !important;
    z-index: 1060 !important;
}
</style>

  <div style="justify-items: center;">
    <form method="GET" action="{% url 'to' %}#service">
      <div class="input-group" style="display: flex; align-items: center; width: 200px;">
        <label class="input-group-text" for="monthSelect" style="float: left;">Месяц</label>
<select class="form-select" style="border-radius: 0px 5px 5px 0px;" id="monthSelect" name="month" onchange="this.form.submit()">
  <option value="1" {% if request.GET.month == '1' or not request.GET.month and current_month == 1 %}selected{% endif %}>Январь</option>
  <option value="2" {% if request.GET.month == '2' or not request.GET.month and current_month == 2 %}selected{% endif %}>Февраль</option>
  <option value="3" {% if request.GET.month == '3' or not request.GET.month and current_month == 3 %}selected{% endif %}>Март</option>
  <option value="4" {% if request.GET.month == '4' or not request.GET.month and current_month == 4 %}selected{% endif %}>Апрель</option>
  <option value="5" {% if request.GET.month == '5' or not request.GET.month and current_month == 5 %}selected{% endif %}>Май</option>
  <option value="6" {% if request.GET.month == '6' or not request.GET.month and current_month == 6 %}selected{% endif %}>Июнь</option>
  <option value="7" {% if request.GET.month == '7' or not request.GET.month and current_month == 7 %}selected{% endif %}>Июль</option>
  <option value="8" {% if request.GET.month == '8' or not request.GET.month and current_month == 8 %}selected{% endif %}>Август</option>
  <option value="9" {% if request.GET.month == '9' or not request.GET.month and current_month == 9 %}selected{% endif %}>Сентябрь</option>
  <option value="10" {% if request.GET.month == '10' or not request.GET.month and current_month == 10 %}selected{% endif %}>Октябрь</option>
  <option value="11" {% if request.GET.month == '11' or not request.GET.month and current_month == 11 %}selected{% endif %}>Ноябрь</option>
  <option value="12" {% if request.GET.month == '12' or not request.GET.month and current_month == 12 %}selected{% endif %}>Декабрь</option>
</select>
        {% if selected_city %}<input type="hidden" name="city" value="{{ selected_city }}">{% endif %}
        {% for color in selected_colors %}<input type="hidden" name="colors" value="{{ color }}">{% endfor %}
      </div>
    </form>
  </div>

  <!-- Форма выбора города -->
  <div style="justify-items: center;">
    <form method="GET" action="{% url 'to' %}#service">
      <div class="input-group" style="width: 300px;">
        <label class="input-group-text" for="city">Город:</label>
        <select class="form-select" style="border-radius: 0px 5px 5px 0px;" name="city" id="city" onchange="this.form.submit()">
          <option value="">Все города</option>
          {% for city in cities %}
          <option value="{{ city }}" {% if city == selected_city %}selected{% endif %}>{{ city }}</option>
          {% endfor %}
        </select>
        <input type="hidden" name="month" value="{{ month }}">
          {% for color in selected_colors %}
            <input type="hidden" name="colors" value="{{ color }}">
          {% endfor %}
      </div>
    </form>
  </div>

<!-- Форма выбора цветов -->
<div style="justify-items: center;">
  <form method="GET" action="{% url 'to' %}#service" id="color-filter-form">
    <div class="input-group" style="width:230px; justify-content: center;">
      <label class="input-group-text">Цвета:</label>
      <div class="dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" 
                id="colorDropdown" data-bs-toggle="dropdown"
                data-bs-display="static" 
                aria-expanded="false" 
                style="width: 155px; color: black; border-radius: 0px 5px 5px 0px; border: var(--bs-border-width) solid var(--bs-border-color);">
          {% if selected_colors %}Выбрано: {{ selected_colors|length }}{% else %}Выберите цвета{% endif %}
        </button>
        {% comment %} <div class="dropdown-menu p-2" aria-labelledby="colorDropdown"> {% endcomment %}
        <div class="dropdown-menu p-2" 
             aria-labelledby="colorDropdown" 
             style="z-index: 1060 !important; position: fixed !important; transform: none !important; inset: auto !important;">
          <div class="form-check">
            <input class="form-check-input color-checkbox" type="checkbox" id="color-green" 
                   name="colors" value="green" 
                   {% if 'green' in selected_colors %}checked{% endif %}>
            <label class="form-check-label" for="color-green">Зеленый</label>
          </div>
          <div class="form-check">
            <input class="form-check-input color-checkbox" type="checkbox" id="color-yellow" 
                   name="colors" value="yellow" 
                   {% if 'yellow' in selected_colors %}checked{% endif %}>
            <label class="form-check-label" for="color-yellow">Желтый</label>
          </div>
          <div class="form-check">
            <input class="form-check-input color-checkbox" type="checkbox" id="color-red" 
                   name="colors" value="red" 
                   {% if 'red' in selected_colors %}checked{% endif %}>
            <label class="form-check-label" for="color-red">Красный</label>
          </div>
          <div class="form-check">
            <input class="form-check-input color-checkbox" type="checkbox" id="color-gray" 
                   name="colors" value="gray" 
                   {% if 'gray' in selected_colors %}checked{% endif %}>
            <label class="form-check-label" for="color-gray">Серый</label>
          </div>
        </div>
      </div>
      <input type="hidden" name="month" value="{{ month }}">
      {% if selected_city %}<input type="hidden" name="city" value="{{ selected_city }}">{% endif %}
    </div>
  </form>
</div>

  <div style="text-align: center;">
    <button type="button" class="btn btn-secondary" onclick="resetFilters()">Сбросить</button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const colorDropdown = document.getElementById('colorDropdown');
  const colorForm = document.getElementById('color-filter-form');
  const colorCheckboxes = document.querySelectorAll('.color-checkbox');
  
  // Обработчик закрытия dropdown
  colorDropdown.addEventListener('hidden.bs.dropdown', function() {
    // Проверяем, были ли изменения в выборе цветов
    let formNeedsSubmit = false;
    const currentColors = [{% for color in selected_colors %}'{{ color }}',{% endfor %}];
    
    colorCheckboxes.forEach(checkbox => {
      const wasSelected = currentColors.includes(checkbox.value);
      if (checkbox.checked !== wasSelected) {
        formNeedsSubmit = true;
      }
    });
    
    if (formNeedsSubmit) {
      colorForm.submit();
    }
  });
  
  // Можно также добавить обработчик изменения чекбоксов
  // для немедленной отправки при клике (по желанию)
  /*
  colorCheckboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      colorForm.submit();
    });
  });
  */
});

function resetFilters() {
  window.location.href = "{% url 'to' %}";
}
</script>
