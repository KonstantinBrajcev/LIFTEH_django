<<<<<<< HEAD
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Добавить ТО</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css">
</head>
<body style="margin: 15px;">
    <h1>Добавление обслуживания</h1>
    <h2>Объект: {{ object.customer }}</h2>


    <!-- Таблица для отображения записей обслуживания -->
    <table class="table table-sm">
        <tr>
            <th>Дата</th>
            <th>Комментарии</th>
            <th>Результат</th>
            <th>User</th>
            <th>Фото</th>
        </tr>
        {% for service in services %}
        <tr>
            <td>{{ service.service_date|date:"d.m.Y H:i" }}</td>
            <td>{{ service.comments }}</td>
            <td>{{ service.result }}</td>
            <td>{{ service.user.username }}</td>
            <td>
                {% if service.foto %}
                    {% comment %} <img src="{{ service.foto.url }}" alt="Фото" style="width: 100px;"> {% endcomment %}
                    <span style="color: green; font-size: 20px;">&#x1F5F9;</span>
                {% else %}
                <span style="color: red; font-size: 20px;">&#x1F5F5;</span>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4">Нет записей обслуживания.</td>
        </tr>
        {% endfor %}
    </table>


    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        {% comment %} <input type="datetime-local" id="service_date" name="service_date" required> {% endcomment %}
        <input type="text" name="service_date" value="{{ current_datetime|date:'Y-m-d H:i:s' }}" required id="service_date" hidden>

        <div class="input-group">
        <label class="input-group-text" for="comments">Комментарии:</label>
        <textarea class="form-control" id="comments" name="comments" rows="4" cols="50" required></textarea>
        </div>

        <div class="input-group">
        <label class="input-group-text" for="result">Результат:</label>
        <input class="form-control" type="text" id="result" name="result" required>
        </div>

        <div class="input-group">
        <label class="input-group-text" for="foto">Фото:</label>
        <input type="file" class="form-control" id="foto" name="foto" accept="image/*">
        </div>
        
        <hr>
        <button type="submit" class="btn btn-success">Сохранить</button>
        <a href="{% url 'to' %}"><button type="button" class="btn btn-primary">Назад</button></a>
    </form>
    

</body>
</html>
=======
<h1>Добавление обслуживания</h1>
<h2>Объект: {{ object.customer }}</h2>
<table class="table table-sm">
    <tr>
        <th>Дата</th>
        <th>Комментарии</th>
        <th>Результат</th>
        <th>User</th>
        <th>Фото</th>
    </tr>
{% for service in services %}
    <tr>
        <td>{{ service.service_date|date:"d.m.Y H:i" }}</td>
        <td>{{ service.comments }}</td>
        <td>{{ service.result }}</td>
        <td>{{ service.user.username }}</td>
        <td>
            {% if service.foto %}
                <span style="color: green; font-size: 20px;">&#x1F5F9;</span>
            {% else %}
                <span style="color: red; font-size: 20px;">&#x1F5F5;</span>
            {% endif %}
        </td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="4">Нет записей обслуживания.</td>
    </tr>
    {% endfor %}
</table>
<form method="POST" enctype="multipart/form-data" id="serviceAddForm">
    {% csrf_token %}
    <input type="text" name="service_date" value="{{ current_datetime|date:'Y-m-d H:i:s' }}" required id="service_date" hidden>
    <div class="input-group">
        <label class="input-group-text" for="comments">Комментарии:</label>
        <textarea class="form-control" id="comments" name="comments" rows="4" cols="50" required></textarea>
    </div>
    <div class="input-group">
        <label class="input-group-text" for="result">Результат:</label>
        <input class="form-control" type="text" id="result" name="result" required>
    </div>
    <div class="input-group">
        <label class="input-group-text" for="foto">Фото:</label>
        <input type="file" class="form-control" id="foto" name="foto" accept="image/*">
    </div>
    <hr>
    <button type="submit" class="btn btn-success">Сохранить</button>
    <button type="button" class="btn btn-primary" onclick="window.history.back()">Назад</button>
</form>

<script>
document.getElementById('serviceAddForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);

    fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => {
        if (response.ok) {
            window.location.reload(); // Перезагружаем страницу после успешного сохранения
        } else {
            return response.text().then(html => {
                document.getElementById('modalFormContent').innerHTML = html;
            });
        }
    })
    .catch(error => console.error('Error:', error));
});
</script>
>>>>>>> bubuka
